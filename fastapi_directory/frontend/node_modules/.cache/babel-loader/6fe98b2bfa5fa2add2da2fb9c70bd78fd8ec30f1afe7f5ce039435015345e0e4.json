{"ast":null,"code":"import _objectSpread from\"C:/Project/Errors/fastapi_directory/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{Typography,Button,IconButton,Box,Grid,Card,CardMedia,CardActions,CardContent,CircularProgress,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Paper}from'@mui/material';import DeleteIcon from'@mui/icons-material/Delete';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const API_BASE_URL=process.env.REACT_APP_API_BASE_URL||'/api';function OrphanedImages(_ref){let{token}=_ref;const[orphanedImages,setOrphanedImages]=useState([]);const[failedErrors,setFailedErrors]=useState([]);const[loading,setLoading]=useState(false);const[loadingFailedErrors,setLoadingFailedErrors]=useState(false);const[errorMsg,setErrorMsg]=useState('');const[errorMsgFailedErrors,setErrorMsgFailedErrors]=useState('');useEffect(()=>{if(!token){setErrorMsg('Требуется авторизация');setErrorMsgFailedErrors('Требуется авторизация');return;}loadOrphanedImages();loadFailedErrors();},[token]);const loadOrphanedImages=async()=>{setLoading(true);setErrorMsg('');try{const response=await axios.get(\"\".concat(API_BASE_URL,\"/errors/images/orphaned/\"),{headers:{Authorization:\"Bearer \".concat(token)}});setOrphanedImages(response.data||[]);}catch(err){var _err$response,_err$response$data;setErrorMsg(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043F\\u0440\\u0438 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0435 \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0439: \".concat(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||err.message));setOrphanedImages([]);}finally{setLoading(false);}};const loadFailedErrors=async()=>{setLoadingFailedErrors(true);setErrorMsgFailedErrors('');try{const response=await axios.get(\"\".concat(API_BASE_URL,\"/errors/images/failed/\"),{headers:{Authorization:\"Bearer \".concat(token)}});setFailedErrors(response.data||[]);}catch(err){var _err$response2,_err$response2$data;setErrorMsgFailedErrors(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043F\\u0440\\u0438 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0435 \\u043E\\u0448\\u0438\\u0431\\u043E\\u043A: \".concat(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.detail)||err.message));setFailedErrors([]);}finally{setLoadingFailedErrors(false);}};const handleDeleteImage=async imageId=>{if(!window.confirm('Вы уверены, что хотите удалить это изображение?'))return;try{await axios.delete(\"\".concat(API_BASE_URL,\"/errors/images/\").concat(imageId),{headers:{Authorization:\"Bearer \".concat(token)}});setOrphanedImages(prev=>prev.filter(img=>img.id!==imageId));setFailedErrors(prev=>prev.map(error=>{var _error$failed_images;return _objectSpread(_objectSpread({},error),{},{failed_images:((_error$failed_images=error.failed_images)===null||_error$failed_images===void 0?void 0:_error$failed_images.filter(img=>img.id!==imageId))||[]});}));}catch(err){var _err$response3,_err$response3$data;alert(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043F\\u0440\\u0438 \\u0443\\u0434\\u0430\\u043B\\u0435\\u043D\\u0438\\u0438: \".concat(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.detail)||err.message));}};return/*#__PURE__*/_jsx(Box,{sx:{width:'100%',maxWidth:1200,margin:'auto',mt:4,p:2}});}export default OrphanedImages;","map":{"version":3,"names":["React","useEffect","useState","Typography","Button","IconButton","Box","Grid","Card","CardMedia","CardActions","CardContent","CircularProgress","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Paper","DeleteIcon","axios","jsx","_jsx","API_BASE_URL","process","env","REACT_APP_API_BASE_URL","OrphanedImages","_ref","token","orphanedImages","setOrphanedImages","failedErrors","setFailedErrors","loading","setLoading","loadingFailedErrors","setLoadingFailedErrors","errorMsg","setErrorMsg","errorMsgFailedErrors","setErrorMsgFailedErrors","loadOrphanedImages","loadFailedErrors","response","get","concat","headers","Authorization","data","err","_err$response","_err$response$data","detail","message","_err$response2","_err$response2$data","handleDeleteImage","imageId","window","confirm","delete","prev","filter","img","id","map","error","_error$failed_images","_objectSpread","failed_images","_err$response3","_err$response3$data","alert","sx","width","maxWidth","margin","mt","p"],"sources":["C:/Project/Errors/fastapi_directory/frontend/src/components/OrphanedImages.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport {\r\n  Typography,\r\n  Button,\r\n  IconButton,\r\n  Box,\r\n  Grid,\r\n  Card,\r\n  CardMedia,\r\n  CardActions,\r\n  CardContent,\r\n  CircularProgress,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow,\r\n  Paper,\r\n} from '@mui/material';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport axios from 'axios';\r\n\r\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL || '/api';\r\n\r\nfunction OrphanedImages({ token }) {\r\n  const [orphanedImages, setOrphanedImages] = useState([]);\r\n  const [failedErrors, setFailedErrors] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingFailedErrors, setLoadingFailedErrors] = useState(false);\r\n  const [errorMsg, setErrorMsg] = useState('');\r\n  const [errorMsgFailedErrors, setErrorMsgFailedErrors] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (!token) {\r\n      setErrorMsg('Требуется авторизация');\r\n      setErrorMsgFailedErrors('Требуется авторизация');\r\n      return;\r\n    }\r\n    loadOrphanedImages();\r\n    loadFailedErrors();\r\n  }, [token]);\r\n\r\n  const loadOrphanedImages = async () => {\r\n    setLoading(true);\r\n    setErrorMsg('');\r\n    try {\r\n      const response = await axios.get(`${API_BASE_URL}/errors/images/orphaned/`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      setOrphanedImages(response.data || []);\r\n    } catch (err) {\r\n      setErrorMsg(`Ошибка при загрузке изображений: ${err.response?.data?.detail || err.message}`);\r\n      setOrphanedImages([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadFailedErrors = async () => {\r\n    setLoadingFailedErrors(true);\r\n    setErrorMsgFailedErrors('');\r\n    try {\r\n      const response = await axios.get(`${API_BASE_URL}/errors/images/failed/`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      setFailedErrors(response.data || []);\r\n    } catch (err) {\r\n      setErrorMsgFailedErrors(`Ошибка при загрузке ошибок: ${err.response?.data?.detail || err.message}`);\r\n      setFailedErrors([]);\r\n    } finally {\r\n      setLoadingFailedErrors(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteImage = async (imageId) => {\r\n    if (!window.confirm('Вы уверены, что хотите удалить это изображение?')) return;\r\n    try {\r\n      await axios.delete(`${API_BASE_URL}/errors/images/${imageId}`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      setOrphanedImages(prev => prev.filter(img => img.id !== imageId));\r\n      setFailedErrors(prev => \r\n        prev.map(error => ({\r\n          ...error,\r\n          failed_images: error.failed_images?.filter(img => img.id !== imageId) || []\r\n        }))\r\n      );\r\n    } catch (err) {\r\n      alert(`Ошибка при удалении: ${err.response?.data?.detail || err.message}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ width: '100%', maxWidth: 1200, margin: 'auto', mt: 4, p: 2 }}>\r\n      {/* ... (остальной JSX остается таким же, но с добавленными проверками ?. как показано выше) ... */}\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default OrphanedImages;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}